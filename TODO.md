# 游泳馆会员管理系统开发进度记录

## 已完成

- [x] 后端基础框架搭建
- [x] 前端基础框架搭建
- [x] 项目配置文件创建
- [x] 前后端端口配置和API代理设置
- [x] 用户认证与权限管理模块开发
- [x] 用户实体类设计与基础Mapper开发
- [x] 用户业务逻辑层（Service）开发
- [x] 用户控制器层（Controller）开发
- [x] 登录与注册前端页面开发及视觉升级
- [x] 教练信息管理模块开发
- [x] 课程管理与预约模块开发
  - 课程CRUD功能（管理员）
  - 课程查询与筛选功能（会员）
  - 课程预约功能（会员）
  - 预约取消功能（会员）
  - 预约记录查看（会员）
  - 课程状态管理（发布/下架）
  - 并发控制（乐观锁防超卖）
  - 时间冲突检测与处理
- [x] 场馆入场管理模块开发
  - 会员入场码生成功能
  - 管理员扫码验证功能
  - 入场记录管理功能
  - 我的入场记录功能
  - 二维码生成与展示
  - 摄像头扫描功能
  - Excel导出功能
  - 实时数据刷新
  - [ ] 统计分析与数据展示模块开发
- [ ] 前端页面开发（会员管理、课程管理、教练管理等）
## 进行中


## 待完成
- [ ] 文章图片资料上传功能(管理员权限管理，仅管理端由此功能)
- [ ] 前后端联调测试
- [ ] 系统部署与优化

## 已解决的问题

- 问题：后端端口配置与前端访问冲突
  - 解决方案：将后端端口设为8080，前端端口设为3000，并配置API代理
  - 时间：2026年1月17日

- 问题：前后端分离架构下跨域访问问题
  - 解决方案：在前端vite.config.js中配置代理，将/api请求转发到后端
  - 时间：2026年1月17日

- 问题：项目文件管理混乱
  - 解决方案：创建backend和frontend目录分别存放后端和前端代码
  - 时间：2026年1月17日

- 问题：用户认证与权限管理模块实现
  - 解决方案：
    - 后端：实现基于 JWT 的身份认证机制，使用 MD5 对密码进行加密存储；完成 User 模块的 DTO、VO 及 Service/Controller 层开发，添加了严格的参数校验。
    - 前端：开发了具有视觉吸引力的登录与注册页面（包含水波动画和游泳主题图标）；封装了 Axios 请求拦截器自动处理 Token，使用 Pinia 管理用户状态。
    - 视觉优化：定制了 Element Plus 的消息提示（ElMessage）样式，统一系统品牌色彩（生态绿/深海蓝）。
    - 时间：2026年1月18日

- 问题：课程预约模块中的并发控制方案选择
  - 解决方案：
    - 需求：防止多用户同时预约导致超卖现象
    - 方案对比：
      1. synchronized同步块：简单但性能差，不支持分布式部署
      2. 悲观锁：性能一般，有死锁风险，适用于高冲突场景
      3. 乐观锁（最终选择）：性能最优，支持分布式，无死锁风险，适用于低冲突场景
      4. 分布式锁：性能一般，依赖中间件，适用于复杂分布式场景
    - 最终选择：采用乐观锁方案，使用MyBatis Plus的@Version注解和OptimisticLockerInnerInterceptor插件
    - 时间：2026年1月18日

- 问题：课程预约模块中的时间冲突处理策略
  - 解决方案：
    - 采用两阶预约模式：
      1. requestBooking阶段：检测用户在指定时间段是否有其他预约，返回冲突信息
      2. confirmBooking阶段：支持强制替换功能，用户可选择是否替换冲突的预约
    - 避免了直接拒绝预约导致的用户体验问题
    - 时间：2026年1月18日

- 问题：后端QueryDTO中LocalDateTime类型的序列化问题
  - 解决方案：
    - 前端GET请求传递时间参数时，后端QueryDTO需要同时使用@JsonFormat和@DateTimeFormat注解
    - @DateTimeFormat用于处理URL参数绑定（GET请求）
    - @JsonFormat用于处理JSON序列化（POST/PUT请求）
    - 相关文件：EntranceRecordQueryDTO.java、BookingQueryDTO.java、CourseQueryDTO.java
    - 时间：2026年1月19日

- 问题：前端扫码验证页面摄像头无法启动
  - 解决方案：
    - 修复v-if条件渲染导致qrcode-stream组件无法初始化的问题
    - 将v-if改为v-show确保组件始终渲染并能触发摄像头初始化
    - 增加权限请求、错误处理和重试机制
    - 相关文件：EntranceVerifyView.vue
    - 时间：2026年1月19日

- 问题：Element Plus分页组件显示英文
  - 解决方案：
    - 在src/main.js中配置Element Plus使用中文语言包
    - 使用locale: zhCn配置实现全局中文化
    - 影响所有Element Plus组件（分页、日期选择器、弹窗等）
    - 相关文件：src/main.js
    - 时间：2026年1月19日

- 问题：入场码功能需要整合到我的预约页面
  - 解决方案：
    - 优化预约页面UI，将入场码功能以对话框形式集成
    - 保留独立的入场码页面作为备用入口
    - 在预约卡片中增加生成入场码按钮，点击后弹出对话框显示完整信息
    - 相关文件：MyBookingsView.vue, EntranceQrcodeView.vue
    - 时间：2026年1月19日

## 课程管理与预约模块需求分析

### 功能需求
1. 课程管理功能（管理员）
   - 课程信息维护（新增、编辑、删除、查询）
   - 课程状态管理（发布、下架）
   - 课程容量控制
   - 课程时间安排

2. 预约管理功能（会员）
   - 课程查询与筛选
   - 课程预约申请
   - 时间冲突检测
   - 预约记录查看与取消

### 技术需求
1. 并发控制：防止课程超卖
2. 时间冲突检测：避免同一用户在同一时间段预约多个课程
3. 数据一致性：确保课程人数统计准确

### 数据库设计
1. 课程表（course）：包含课程基本信息、容量、当前预约数、版本号（乐观锁）、状态等
2. 预约表（booking）：包含用户ID、课程ID、预约时间、状态、取消时间等

### 并发控制方案对比分析
1. synchronized同步块
   - 优点：实现简单，保证线程安全
   - 缺点：性能差，阻塞线程，不支持分布式部署
   - 适用场景：单机应用，低并发场景

2. 悲观锁
   - 优点：数据一致性强，适合高冲突场景
   - 缺点：性能一般，有死锁风险，资源占用高
   - 适用场景：数据竞争激烈，冲突频繁的场景

3. 乐观锁（推荐方案）
   - 优点：性能最优，支持分布式，无死锁风险，适合低冲突场景
   - 缺点：冲突时需要重试，极端情况下可能失败
   - 适用场景：高并发，冲突较少的场景（如课程预约）

4. 分布式锁
   - 优点：支持分布式环境，强一致性
   - 缺点：依赖中间件，性能一般，实现复杂
   - 适用场景：复杂的分布式系统，需要强一致性的场景

最终选择乐观锁方案，利用MyBatis Plus的@Version注解和OptimisticLockerInnerInterceptor插件实现，既能保证数据一致性，又能提供良好的性能表现。

## 场馆入场管理模块需求分析

### 功能需求
1. 二维码生成功能（会员）
   - 生成一次性入场二维码
   - 二维码缩放展示（200/300/400px三档）
   - 支持全屏展示
   - 提供令牌复制功能（长按复制）

2. 扫码验证功能（管理员）
   - 摄像头扫描二维码
   - 手动输入令牌验证
   - 验证结果显示

3. 入场记录管理（管理员）
   - 入场记录查询
   - 入场记录删除
   - Excel导出功能
   - 记录详情查看

4. 我的入场记录（会员）
   - 个人入场记录查询
   - 记录详情查看
   - 实时数据刷新

### 技术需求
1. 二维码生成：使用qrcode-vue3库
2. 摄像头扫描：使用vue-qrcode-reader库
3. Excel导出：使用xlsx库
4. 实时刷新：使用setInterval定时刷新
5. 权限控制：基于JWT的用户角色控制

### 数据库设计
1. 入场二维码表（entrance_qrcode）：包含令牌、用户ID、生成时间、关联课程ID、使用状态、使用时间等
2. 入场记录表（entrance_record）：包含用户ID、入场时间、验证人ID、关联课程ID、入场令牌等

### 用户界面设计
1. 会员端界面：生成入场码、我的入场记录
2. 管理员端界面：扫码验证、入场记录管理
3. 响应式设计：支持桌面端和移动端访问