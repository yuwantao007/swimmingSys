# 游泳馆会员管理系统开发进度记录

## 已完成

- [x] 后端基础框架搭建
- [x] 前端基础框架搭建
- [x] 项目配置文件创建
- [x] 前后端端口配置和API代理设置
- [x] 用户认证与权限管理模块开发
- [x] 用户实体类设计与基础Mapper开发
- [x] 用户业务逻辑层（Service）开发
- [x] 用户控制器层（Controller）开发
- [x] 登录与注册前端页面开发及视觉升级
- [x] 教练信息管理模块开发
- [x] 课程管理与预约模块开发
- [ ] 会员信息管理模块开发

## 进行中


## 待完成

- [ ] 场馆入场管理模块开发
- [ ] 统计分析与数据展示模块开发
- [ ] 前端页面开发（会员管理、课程管理、教练管理等）
- [ ] 前后端联调测试
- [ ] 系统部署与优化

## 已解决的问题

- 问题：后端端口配置与前端访问冲突
  - 解决方案：将后端端口设为8080，前端端口设为3000，并配置API代理
  - 时间：2026年1月17日

- 问题：前后端分离架构下跨域访问问题
  - 解决方案：在前端vite.config.js中配置代理，将/api请求转发到后端
  - 时间：2026年1月17日

- 问题：项目文件管理混乱
  - 解决方案：创建backend和frontend目录分别存放后端和前端代码
  - 时间：2026年1月17日

- 问题：用户认证与权限管理模块实现
  - 解决方案：
    - 后端：实现基于 JWT 的身份认证机制，使用 MD5 对密码进行加密存储；完成 User 模块的 DTO、VO 及 Service/Controller 层开发，添加了严格的参数校验。
    - 前端：开发了具有视觉吸引力的登录与注册页面（包含水波动画和游泳主题图标）；封装了 Axios 请求拦截器自动处理 Token，使用 Pinia 管理用户状态。
    - 视觉优化：定制了 Element Plus 的消息提示（ElMessage）样式，统一系统品牌色彩（生态绿/深海蓝）。
    - 时间：2026年1月18日

- 问题：课程预约模块中的并发控制方案选择
  - 解决方案：
    - 需求：防止多用户同时预约导致超卖现象
    - 方案对比：
      1. synchronized同步块：简单但性能差，不支持分布式部署
      2. 悲观锁：性能一般，有死锁风险，适用于高冲突场景
      3. 乐观锁（最终选择）：性能最优，支持分布式，无死锁风险，适用于低冲突场景
      4. 分布式锁：性能一般，依赖中间件，适用于复杂分布式场景
    - 最终选择：采用乐观锁方案，使用MyBatis Plus的@Version注解和OptimisticLockerInnerInterceptor插件
    - 时间：2026年1月18日

- 问题：课程预约模块中的时间冲突处理策略
  - 解决方案：
    - 采用两阶预约模式：
      1. requestBooking阶段：检测用户在指定时间段是否有其他预约，返回冲突信息
      2. confirmBooking阶段：支持强制替换功能，用户可选择是否替换冲突的预约
    - 避免了直接拒绝预约导致的用户体验问题
    - 时间：2026年1月18日

## 课程管理与预约模块需求分析

### 功能需求
1. 课程管理功能（管理员）
   - 课程信息维护（新增、编辑、删除、查询）
   - 课程状态管理（发布、下架）
   - 课程容量控制
   - 课程时间安排

2. 预约管理功能（会员）
   - 课程查询与筛选
   - 课程预约申请
   - 时间冲突检测
   - 预约记录查看与取消

### 技术需求
1. 并发控制：防止课程超卖
2. 时间冲突检测：避免同一用户在同一时间段预约多个课程
3. 数据一致性：确保课程人数统计准确

### 数据库设计
1. 课程表（course）：包含课程基本信息、容量、当前预约数、版本号（乐观锁）、状态等
2. 预约表（booking）：包含用户ID、课程ID、预约时间、状态、取消时间等

### 并发控制方案对比分析
1. synchronized同步块
   - 优点：实现简单，保证线程安全
   - 缺点：性能差，阻塞线程，不支持分布式部署
   - 适用场景：单机应用，低并发场景

2. 悲观锁
   - 优点：数据一致性强，适合高冲突场景
   - 缺点：性能一般，有死锁风险，资源占用高
   - 适用场景：数据竞争激烈，冲突频繁的场景

3. 乐观锁（推荐方案）
   - 优点：性能最优，支持分布式，无死锁风险，适合低冲突场景
   - 缺点：冲突时需要重试，极端情况下可能失败
   - 适用场景：高并发，冲突较少的场景（如课程预约）

4. 分布式锁
   - 优点：支持分布式环境，强一致性
   - 缺点：依赖中间件，性能一般，实现复杂
   - 适用场景：复杂的分布式系统，需要强一致性的场景

最终选择乐观锁方案，利用MyBatis Plus的@Version注解和OptimisticLockerInnerInterceptor插件实现，既能保证数据一致性，又能提供良好的性能表现。